# 离线需求对接规范

# Step1：需求准入与评审

**目标：** 防止“一句话需求”和无休止的范围蔓延。

1.  **标准化提单：** 业务方必须填写[请至钉钉文档查看附件《需求模板Excel版V1.0》](https://alidocs.dingtalk.com/i/nodes/20eMKjyp81OkAby1S9Z2dLkEVxAZB1Gv?iframeQuery=anchorId%3DX02mkm85won3taoq7uzqwr)，包含：业务背景、统计口径（明确分子分母）、维度（按什么拆分）、期望交付日期、数据用途。
    
2.  **需求评审：**模板填写完成后，两天内进入数据探查阶段
    

# Step2：需求反讲（针对复杂需求）

**目标：** 防止需求理解不到位，所得非所需的现象

反讲讲什么？

1.  业务逻辑“转译” (Business Logic Translation) 开发人员**用自己的语言**描述业务场景，而不是复述文档
    
2.  口径边界“暴力”确认 (Boundary Confirmation) 针对模糊词汇进行“抬杠式”确认。
    
    1.  要点： 
        
        1.  剔除逻辑： “你说统计 收入，那退款的算吗？测试账号算吗？”
            
        2.  时间定义： “你说‘近7天’，是包含今天吗？是按照书籍上架日期还是书籍起投日期？”
            
        3.  统计粒度： “最后出的报表是一行一个计划，还是一行一个素材？”
            
3.  指标拆解与公式化 (Metric Deconstruction) 将自然语言转为数学公式。
    
    1.  要点： 现场推演复合指标。
        
        1.  例如： “我理解的达标率 = 达标的计划对应消耗 / 所有消耗，对吗？”
            
        2.  核心目标： 避免在代码写完后，业务方说“我的达标率不是这么算的”。
            
4.  逆向影响分析 (Impact Feedback) 从技术视角反向告知业务方可能存在的“副作用”。
    
    1.  要点： “如果你坚持要看实时5分钟级的Roi，目前的集群资源可能会导致报表查询有半小时延迟，你能接受吗？”
        
    2.  核心目标： 提前对齐交付预期，防止交付后被吐槽“太慢”或“数据对不上”。
        

# Step3：数据探查

**目标：** 在数据开发中，“**不探查，不设计**”应该是最高准则。很多需求延期和质量问题的根源，就在于开发人员凭“经验”以为源头数据是干净的，结果写代码时才发现字段全是空值或口径变了。

    比如Reelife打点 $\color{#0089FF}{@闫天赐}$ ，**在数据探查阶段提出打点质量问题，是专业细心。在需求交付阶段才提出，责无旁贷。**

    **谨记：** “**宁可在探查阶段多花 2 小时找 Bug，也不要在代码写完后花 2 天去修数据**。”

数据探查做什么？

1.  基础分布探查（量化体感） 首先要确认源头表的“健康度”，防止逻辑建立在流沙之上
    
    1.  记录数与趋势： 总量是多少？日增量是多少？是否有严重的日期断档？
        
    2.  空值率（Null Rate）： 核心字段（如 user\_id, campaign\_id, ad\_type）的空值占比。如果空值率 > 5%（视业务场景而定），必须找业务方确认逻辑
        
    3.  唯一性（Uniqueness）： 确认主键（或业务主键）是否真的唯一。很多 dwd 表会有重复抽数导致的重复行
        
2.  值域与枚举探查（语义理解） 验证业务口径在数据层面的真实映射
    
    1.  枚举分布： 查看状态位字段的所有取值
        
        1.  案例： 业务说 bookId 只有 4 和 5开头，探查发现出现了 0 和 9，这时必须回过头问业务：这些新前缀代表什么？
            
    2.  极值与异常值： 最大值、最小值、平均值
        
        1.  案例： 发现“播放时长”出现了9999秒，说明源头存在脏数据，代码设计时需考虑过滤逻辑
            
3.  关联关系探查（确定性验证） 验证表与表之间是否真的能“连得上”
    
    1.  外键覆盖率（Join Coverage）： 模拟一次 LEFT JOIN。
        
        1.  动作： 用事实表去关联维度表，看丢包率（Missing Rate）是多少。如果 20% 的计划找不到对应渠道号，说明底层维度缺失，需要反馈给上游
            
    2.  一对多/多对多验证： 验证关联关系是否符合预期。
        
4.  业务逻辑预演算（口径核对） 在写正式 ETL 之前，先写几行简单的 SQL 算一下核心指标
    
    1.  指标对齐： 用最粗犷的 SQL 算一下昨天的总消耗，看是否跟业务报表或源系统的总数对得上
        
    2.  数据类型陷阱： 检查字段类型。例如：有些金额字段在源头是 String，里面混入了特殊字符（如逗号），这会直接导致后期计算溢出
        

# Step4：设计与技术方案评审

**目标：** 解决“交付质量差”的源头——模型设计不合理

1.  **设计文档化：** 技术文档需要写清楚表结构设计、ETL 逻辑流程图，可参考[《技术方案文档模板》](https://alidocs.dingtalk.com/i/nodes/Qnp9zOoBVBexAwKGHGXr75laW1DK0g6l)，当然不拘泥于格式，能体现要点也可以，提供一个比较好的案例[《短剧-归因策略迭代-3+8-技术方案》](https://alidocs.dingtalk.com/i/nodes/a9E05BDRVQNAjdaQUpEQlBbqJ63zgkYA?utm_scene=team_space&utm_medium=dingdoc_doc_plugin_card&utm_source=dingdoc_doc)
    
2.  **同行评审（Peer Review）：** 方案必须经过组内另一位同学评审
    
    *   **核心关注点：** 是否符合数仓分层规范、是否考虑了幂等性、是否有性能隐患
        

# Step5：DQC 配置

**目标：** 主动发现问题，让局面尽在掌控

1.  **DQC（数据质量检查）三板斧：** 任何产出表必须配置以下监控，否则不允许上线：
    
    *   **主键唯一性：** 防止数据重复。
        
    *   **数据量波动：** 环比昨日/上周波动超过阈值报警。
        
    *   **核心字段空值率：** 关键维度和指标不能为 Null。
        

# Step6：用户验收与交付

**目标：** 确保“我给的”就是“你要的”。

1.  **自测报告：** 开发需提供自测 SQL 和结果对比图，证明逻辑符合评审口径
    
2.  **业务验收签字：** 业务方需在测试环境确认数据结果
    
    *   **核心操作：** 业务方确认无误后，在钉钉群或系统内回复“确认无误，申请上线”